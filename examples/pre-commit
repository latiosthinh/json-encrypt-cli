#!/bin/sh
# JSON Encryption Pre-commit Hook
# This script automatically encrypts sensitive JSON files before commits

echo "üîê Encrypting sensitive JSON files..."

# Define directories containing sensitive JSON files
# Modify these paths according to your project structure
SENSITIVE_DIRS=(
    "src/config"
    "data/secrets"
    "config/production"
)

# Check if any sensitive directories exist and encrypt them
for dir in "${SENSITIVE_DIRS[@]}"; do
    if [ -d "$dir" ]; then
        echo "üìÅ Encrypting JSON files in: $dir"
        npx json-batch-encrypt "$dir" --recursive
        
        # Check if encryption was successful
        if [ $? -eq 0 ]; then
            echo "‚úÖ Successfully encrypted files in $dir"
            git add "$dir"
        else
            echo "‚ùå Failed to encrypt files in $dir"
            exit 1
        fi
    else
        echo "‚ö†Ô∏è  Directory not found: $dir (skipping)"
    fi
done

echo "üéâ Pre-commit encryption completed!"
exit 0